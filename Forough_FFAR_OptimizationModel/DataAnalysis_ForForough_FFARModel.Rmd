---
title: "DataAnalysis_ForForough_FFARModel"
author: "Sarah I. Murphy"
date: "2/16/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Set-up environment
```{r}
#load packages
library(readr)
library(dplyr)
library(splitstackshape)
library(ggplot2)


load("MCsim_N1_S1.RData")
#data$logCount_init  <- -2.802 #change for each of 5 rounds here & in next chunk
df_F1 <- data

load("MCsim_N2_S1.RData")
#data$logCount_init  <- -2.677 #change for each of 5 rounds here & in next chunk
df_F2 <- data

load("MCsim_N3_S1.RData")
#data$logCount_init  <- -2.376 #change for each of 5 rounds here & in next chunk
df_F3 <- data

load("MCsim_N4_S1.RData")
#data$logCount_init  <- 0.309 #change for each of 5 rounds here & in next chunk
df_F4 <- data

load("MCsim_N5_S1.RData")
#data$logCount_init  <- -6.8  #change for each of 5 rounds here & in next chunk
df_F5 <- data

#join files
data<-rbind(df_F1,df_F2,df_F3,df_F4,df_F5)
#data<-rbind(df_F1,df_F2,df_F3,df_F4,df_F5)
```

```{r}
#write example .csv file
write.csv(data, "data_May26.csv")
```


## Data Analysis   ---- 
```{r}
data$lot_id<- as.factor(data$lot_id) 
data$day<- as.factor(data$day)
data$logCount_init<- as.factor(data$logCount_init)

#Calculate the mean count by day
data %>%
  group_by(logCount_init,day) %>%
  summarise(mean = mean(count), sd = sd(count))-> mean_byDay
mean_byDay
```

```{r}
ggplot(data=data, aes(x=day,y=count,col=logCount_init))+
  scale_y_continuous(limits = c(-2.5, 8), breaks = seq(-2, 8, by = 1))+
  geom_violin()+
  labs(y = "Milk spore count (log10 MPN/mL)", x = "Day" )
```



```{r}
#what percent of samples spoiled for each day in shelf life
days <- seq(1, 35, 1)
spoiled <- vector(mode = "logical", length(days))
spoiled_by_day <- data.frame(days, spoiled)

for (d in days) {
  numerator <-   length(which(subset(data, data$day == d)$count>4.3))
  denominator <- length(subset(data, data$day == d)$count)
  
  spoiled_by_day[spoiled_by_day$days==d,]$spoiled <- numerator / denominator * 100
}

spoiled_by_day$days <- factor(spoiled_by_day$days)
```

# -7.279     -3.279     -2.501     -1.802     -1.237     -0.720     -0.201     0.549  

```{r}
#what percent of samples spoiled for each day in shelf life
#get data
data1 <- data %>%
  filter(logCount_init == -7.279)

data2 <- data %>%
  filter(logCount_init == -3.279)

data3 <- data %>%
  filter(logCount_init == -2.501)

data4 <- data %>%
filter(logCount_init == -1.802)

data5 <- data %>%
  filter(logCount_init == -1.237)

#days
days1 <- seq(1, 35, 1)
days2 <- seq(1, 35, 1)
days3 <- seq(1, 35, 1)
days4 <- seq(1, 35, 1)
days5 <- seq(1, 35, 1)

spoiled1 <- vector(mode = "logical", length(days1))
spoiled2 <- vector(mode = "logical", length(days2))
spoiled3 <- vector(mode = "logical", length(days3))
spoiled4 <- vector(mode = "logical", length(days4))
spoiled5 <- vector(mode = "logical", length(days5))

#make df
spoiled_by_day1 <- data.frame(days1, spoiled1)
spoiled_by_day2 <- data.frame(days2, spoiled2)
spoiled_by_day3 <- data.frame(days3, spoiled3)
spoiled_by_day4 <- data.frame(days4, spoiled4)
spoiled_by_day5 <- data.frame(days5, spoiled5)


for (d in days1) {
  numerator1 <-   length(which(subset(data1, data1$day == d)$count>6))
  denominator1 <- length(subset(data1, data1$day == d)$count)
  
  spoiled_by_day1[spoiled_by_day1$days1==d,]$spoiled1 <- numerator1 / denominator1 * 100
}

spoiled_by_day1$days1 <- factor(spoiled_by_day1$days1)
first_day1 <- spoiled_by_day1[spoiled_by_day1$spoiled1>5,'days1'][1]

for (d in days2) {
  numerator2 <-   length(which(subset(data2, data2$day == d)$count>6))
  denominator2 <- length(subset(data2, data2$day == d)$count)
  
  spoiled_by_day2[spoiled_by_day2$days2==d,]$spoiled2 <- numerator2 / denominator2 * 100
}

spoiled_by_day2$days2 <- factor(spoiled_by_day2$days2)
first_day2 <- spoiled_by_day2[spoiled_by_day2$spoiled2>5,'days2'][1]

for (d in days3) {
  numerator3 <-   length(which(subset(data3, data3$day == d)$count>6))
  denominator3 <- length(subset(data3, data3$day == d)$count)
  
  spoiled_by_day3[spoiled_by_day3$days3==d,]$spoiled3 <- numerator3 / denominator3 * 100
}

spoiled_by_day3$days3 <- factor(spoiled_by_day3$days3)
first_day3 <- spoiled_by_day3[spoiled_by_day3$spoiled3>5,'days3'][1]

for (d in days4) {
  numerator4 <-   length(which(subset(data4, data4$day == d)$count>6))
  denominator4 <- length(subset(data4, data4$day == d)$count)
  
  spoiled_by_day4[spoiled_by_day4$days4==d,]$spoiled4 <- numerator4 / denominator4 * 100
}

spoiled_by_day4$days4 <- factor(spoiled_by_day4$days4)
first_day4 <- spoiled_by_day4[spoiled_by_day4$spoiled4>5,'days4'][1]

for (d in days5) {
  numerator5 <-   length(which(subset(data5, data5$day == d)$count>6))
  denominator5 <- length(subset(data5, data5$day == d)$count)
  
  spoiled_by_day5[spoiled_by_day5$days5==d,]$spoiled5 <- numerator5 / denominator5 * 100
}

spoiled_by_day5$days5 <- factor(spoiled_by_day5$days5)
first_day5 <- spoiled_by_day5[spoiled_by_day5$spoiled5>5,'days5'][1]

first_day1
first_day2
first_day3
first_day4
first_day5
```





# dev.off()
```
